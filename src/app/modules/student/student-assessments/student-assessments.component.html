<div class="flex min-w-0 flex-auto flex-col">
    <!-- Main -->
    <div class="-mt-px flex-auto border-t pt-6">
        <div class="mx-auto w-full max-w-screen-lg">
            <!-- Course Tabs -->
            <mat-tab-group (selectedIndexChange)="onCourseTabChange($event)">
                <mat-tab
                    *ngFor="let course of myCourses; let courseIndex = index"
                    [label]="course.courseCode"
                >
                    <ng-template matTabContent>
                        <!-- Semester Selection -->
                        <div class="mt-4 flex justify-start gap-3 px-4">
                            <mat-button-toggle-group
                                name="semesterGroup"
                                appearance="standard"
                                [(value)]="selectedSemester"
                                (change)="
                                    onSemesterTabChange(
                                        courseIndex,
                                        $event.value
                                    )
                                "
                            >
                                <mat-button-toggle
                                    *ngFor="
                                        let semester of getSemesters(
                                            course.duration
                                        )
                                    "
                                    [value]="'SEMESTER_' + semester"
                                >
                                    Semester {{ semester }}
                                </mat-button-toggle>
                            </mat-button-toggle-group>
                        </div>

                        <!-- Modules Display -->
                        <div class="mt-6 grid w-full p-3">
                            <div class="flex flex-col gap-6">
                                <!-- Loop through Modules -->
                                <div
                                    *ngFor="let module of modules"
                                    class="rounded-lg bg-white p-6 shadow-lg dark:bg-gray-800"
                                >
                                    <!-- Module Header -->
                                    <div
                                        class="flex items-center justify-between"
                                    >
                                        <div>
                                            <h3
                                                class="text-xl font-semibold text-gray-800 dark:text-gray-100"
                                            >
                                                {{ module.moduleName }}
                                            </h3>
                                            <p
                                                class="text-sm text-gray-600 dark:text-gray-400"
                                            >
                                                {{ module.moduleCode }}
                                            </p>
                                        </div>
                                    </div>

                                    <!-- Assignments Section -->
                                    <div class="mt-4">
                                        <h4
                                            class="text-md font-semibold text-gray-700 dark:text-gray-300"
                                        >
                                            Assignments
                                        </h4>

                                        <!-- Loop Through Assignments -->
                                        <div
                                            *ngFor="
                                                let assignment of filteredAssignments(
                                                    module.id
                                                )
                                            "
                                            class="mt-4"
                                        >
                                            <div
                                                class="rounded-lg border border-gray-300 bg-gray-50 p-4 shadow-md dark:bg-gray-700"
                                            >
                                                <!-- Assignment Header -->
                                                <div
                                                    class="flex items-center justify-between"
                                                >
                                                    <div>
                                                        <h5
                                                            class="text-lg font-medium text-gray-900 dark:text-white"
                                                        >
                                                            {{
                                                                assignment.title
                                                            }}
                                                        </h5>
                                                        <p
                                                            class="text-sm font-medium text-gray-600 dark:text-gray-300"
                                                        >
                                                            Due:
                                                            <span
                                                                class="font-bold"
                                                                [ngClass]="
                                                                    isDeadlineNear(
                                                                        assignment.deadLine
                                                                    )
                                                                        ? 'text-red-600'
                                                                        : 'text-gray-600'
                                                                "
                                                            >
                                                                {{
                                                                    assignment.deadLine
                                                                        | date
                                                                            : 'medium'
                                                                }}
                                                            </span>
                                                        </p>
                                                    </div>
                                                    <button
                                                        mat-icon-button
                                                        (click)="
                                                            toggleAssignmentDetails(
                                                                assignment.id
                                                            )
                                                        "
                                                    >
                                                        <mat-icon>
                                                            {{
                                                                expandedAssignments.includes(
                                                                    assignment.id
                                                                )
                                                                    ? 'expand_less'
                                                                    : 'expand_more'
                                                            }}
                                                        </mat-icon>
                                                    </button>
                                                </div>

                                                <!-- Assignment Details (Expanded) -->
                                                <div
                                                    *ngIf="
                                                        expandedAssignments.includes(
                                                            assignment.id
                                                        )
                                                    "
                                                    class="mt-3 border-t pt-4"
                                                >
                                                    <p
                                                        class="text-sm text-gray-700 dark:text-gray-300"
                                                    >
                                                        {{
                                                            assignment.description
                                                        }}
                                                    </p>

                                                    <!-- Submission Form -->
                                                    <div
                                                        class="mt-4 rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:bg-gray-800"
                                                    >
                                                        <h6
                                                            class="text-md font-medium text-gray-800 dark:text-gray-200"
                                                        >
                                                            Submit Your Work
                                                        </h6>

                                                        <!-- File Upload -->
                                                        <label
                                                            class="mt-2 block"
                                                        >
                                                            <input
                                                                type="file"
                                                                (change)="
                                                                    onFileSelected(
                                                                        $event,
                                                                        assignment.id
                                                                    )
                                                                "
                                                                accept=".doc,.docx"
                                                                class="hidden"
                                                                #fileInput
                                                            />
                                                            <div
                                                                class="flex cursor-pointer items-center justify-center rounded-md border border-gray-300 bg-gray-100 p-3 dark:border-gray-600 dark:bg-gray-700"
                                                            >
                                                                <mat-icon
                                                                    class="text-gray-600"
                                                                    >attach_file</mat-icon
                                                                >
                                                                <span
                                                                    class="ml-2 text-sm text-gray-700 dark:text-gray-300"
                                                                >
                                                                    {{
                                                                        selectedFiles[
                                                                            assignment
                                                                                .id
                                                                        ]
                                                                            ?.name ||
                                                                            'Attach Word Document (.doc, .docx)'
                                                                    }}
                                                                </span>
                                                            </div>
                                                        </label>

                                                        <!-- Error Message -->
                                                        <p
                                                            *ngIf="
                                                                fileErrors[
                                                                    assignment
                                                                        .id
                                                                ]
                                                            "
                                                            class="mt-1 text-sm text-red-500"
                                                        >
                                                            {{
                                                                fileErrors[
                                                                    assignment
                                                                        .id
                                                                ]
                                                            }}
                                                        </p>

                                                        <!-- Submit Button -->
                                                        <button
                                                            mat-flat-button
                                                            color="primary"
                                                            class="mt-3 w-full"
                                                            [disabled]="
                                                                !selectedFiles[
                                                                    assignment
                                                                        .id
                                                                ]
                                                            "
                                                            (click)="
                                                                submitAssignment(
                                                                    assignment.id
                                                                )
                                                            "
                                                        >
                                                            Submit Assignment
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- No Assignments -->
                                        <p
                                            *ngIf="
                                                filteredAssignments(module.id)
                                                    .length === 0
                                            "
                                            class="mt-2 text-sm text-gray-500"
                                        >
                                            No assignments available.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </mat-tab>
            </mat-tab-group>
        </div>
    </div>
</div>
